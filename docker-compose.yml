# PostgreSQL 데이터베이스 서비스
# 이 파일을 사용하여 Docker로 PostgreSQL 데이터베이스를 쉽게 실행할 수 있습니다.

version: '3.8'

services:
  # PostgreSQL 데이터베이스 서비스
  postgres:
    image: postgres:15-alpine  # PostgreSQL 15 버전 사용 (가벼운 Alpine Linux 기반)
    container_name: todo_postgres  # 컨테이너 이름
    restart: unless-stopped  # 시스템 재시작 시 자동 시작
    environment:
      # 데이터베이스 설정
      POSTGRES_DB: todo_db          # 데이터베이스 이름
      POSTGRES_USER: todo_user      # 데이터베이스 사용자명
      POSTGRES_PASSWORD: 1234       # 간단한 비밀번호
      POSTGRES_HOST_AUTH_METHOD: trust  # 로컬 개발용 (프로덕션에서는 제거)
      # UTF-8 로케일 설정
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=C"
      LANG: C.UTF-8
      LC_ALL: C.UTF-8
    ports:
      - "5433:5432"  # 호스트 포트 5433을 컨테이너 포트 5432에 매핑 (포트 충돌 방지)
    volumes:
      # 데이터 영속성을 위한 볼륨 마운트
      - postgres_data:/var/lib/postgresql/data
      # 초기 데이터베이스 설정 (선택사항)
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    networks:
      - todo_network

  # pgAdmin (PostgreSQL 관리 도구) - 선택사항
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: todo_pgadmin
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@todo.com
      PGADMIN_DEFAULT_PASSWORD: admin123
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    ports:
      - "5050:80"  # pgAdmin 웹 인터페이스
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    depends_on:
      - postgres
    networks:
      - todo_network

# 네트워크 정의
networks:
  todo_network:
    driver: bridge

# 볼륨 정의 (데이터 영속성)
volumes:
  postgres_data:
    driver: local
  pgadmin_data:
    driver: local
